<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ÅžÃ¼kÃ¼r Villa - Takvim Rezervasyon</title>
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 20px; }
    form { max-width: 400px; margin: auto; display: flex; flex-direction: column; gap: 10px; }
    input, textarea, button { padding: 10px; font-size: 1em; }
    button { cursor: pointer; }
    #authorize_button, #signout_button { margin: 10px auto; }
  </style>
  <!-- 1) Load Google's API client library -->
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h1>ÅžÃ¼kÃ¼r Villa Rezervasyon (Takvime Ekle)</h1>

  <!-- OAuth buttons -->
  <button id="authorize_button">Authorize Google Calendar</button>
  <button id="signout_button" style="display:none;">Sign Out</button>

  <!-- Reservation Form -->
  <form id="reservation-form" style="display:none;">
    <label>AdÄ±nÄ±z:
      <input type="text" id="name" required>
    </label>
    <label>Email:
      <input type="email" id="email" required>
    </label>
    <label>GiriÅŸ Tarihi:
      <input type="date" id="checkin" required>
    </label>
    <label>Ã‡Ä±kÄ±ÅŸ Tarihi:
      <input type="date" id="checkout" required>
    </label>
    <label>Misafir SayÄ±sÄ±:
      <input type="number" id="guests" min="1" required>
    </label>
    <button type="submit">Takvime Ekle</button>
  </form>

  <script>
    // 2) TODO Mustafa: Replace with your own values
    const API_KEY = 'AIzaSyA2SsVMVxrwICycfVK6PvUqRWvsQiXDzVQ';            // <!-- TODO Mustafa: Google API Key -->
    const CLIENT_ID = '347552651867-04a55j09hhhn6fcdl2ua7d2if857l2nl.apps.googleusercontent.com';  // <!-- TODO Mustafa: OAuth 2.0 Client ID -->
    const CALENDAR_ID = 'primary';                  // <!-- TODO Mustafa: or your custom calendar ID -->

    // Authorization scopes required
    const SCOPES = 'https://www.googleapis.com/auth/calendar.events';

    const authorizeButton = document.getElementById('authorize_button');
    const signoutButton   = document.getElementById('signout_button');
    const formEl          = document.getElementById('reservation-form');

    // Load the API and make an OAuth2 client
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
        scope: SCOPES
      }).then(() => {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        // Set initial state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = () => gapi.auth2.getAuthInstance().signIn();
        signoutButton.onclick  = () => gapi.auth2.getAuthInstance().signOut();
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display   = 'block';
        formEl.style.display           = 'flex';
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display   = 'none';
        formEl.style.display           = 'none';
      }
    }

    // 3) On form submit, insert event
    formEl.addEventListener('submit', (e) => {
      e.preventDefault();

      const name     = document.getElementById('name').value;
      const email    = document.getElementById('email').value;
      const checkin  = document.getElementById('checkin').value;
      const checkout = document.getElementById('checkout').value;
      const guests   = document.getElementById('guests').value;

      // Format dates as RFC3339 (YYYY-MM-DDT00:00:00)
      const toRFC = (dateStr) => dateStr + 'T12:00:00'; // using noon UTC to avoid timezone drift

      const event = {
        summary: `ÅžÃ¼kÃ¼r Villa Rezervasyonu - ${name}`,
        location: 'Efeler, 09270 Didim/AydÄ±n, TÃ¼rkiye',
        description:
          `Misafir: ${name}\nEmail: ${email}\nMisafir SayÄ±sÄ±: ${guests}`,
        start: { dateTime: toRFC(checkin) },
        end:   { dateTime: toRFC(checkout) }
      };

      gapi.client.calendar.events.insert({
        calendarId: CALENDAR_ID,
        resource: event
      }).then(response => {
        alert('Takviminize eklendi! ðŸŽ‰');
        formEl.reset();
      }, err => {
        console.error('Hata:', err);
        alert('Takvim ekleme baÅŸarÄ±sÄ±z oldu.');
      });
    });

    // Kick everything off
    handleClientLoad();
  </script>
</body>
</html>
